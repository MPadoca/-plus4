<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#ffffff">
    <meta name="description" content="Track how your city is warming">
    <title>+4° - Track how your city is warming</title>
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIis0wrAgLSBUcmFjayBob3cgeW91ciBjaXR5IGlzIHdhcm1pbmciLAogICJzaG9ydF9uYW1lIjogIis0wrAiLAogICJkZXNjcmlwdGlvbiI6ICJUcmFjayBob3cgeW91ciBjaXR5IGlzIHdhcm1pbmciLAogICJzdGFydF91cmwiOiAiLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiI2ZmZmZmZiIsCiAgInRoZW1lX2NvbG9yIjogIiNmZmZmZmYiLAogICJpY29ucyI6IFtdCn0=">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #000;
        }

        /* Splash Screen */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s;
        }

        .splash-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .splash-logo {
            font-size: 120px;
            font-weight: 900;
            letter-spacing: -5px;
            margin-bottom: 20px;
        }

        .splash-tagline {
            font-size: 18px;
            color: #666;
            font-weight: 400;
        }

        .splash-button {
            margin-top: 40px;
            padding: 16px 60px;
            background: white;
            border: 2px solid #000;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .splash-button:hover {
            background: #000;
            color: white;
        }

        /* Main App */
        .app-container {
            display: none;
            max-width: 500px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
        }

        .app-container.visible {
            display: block;
        }

        .header {
            padding: 20px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #e5e5e5;
        }

        .back-button {
            font-size: 24px;
            cursor: pointer;
            margin-right: 15px;
        }

        .location-name {
            font-size: 20px;
            font-weight: 600;
        }

        .screen {
            display: none;
            min-height: calc(100vh - 61px);
        }

        .screen.active {
            display: block;
        }

        /* Current Weather Screen */
        .current-weather-screen {
            padding: 40px 30px;
            text-align: center;
        }

        .temp-display {
            font-size: 120px;
            font-weight: 900;
            line-height: 1;
            margin: 40px 0 20px;
        }

        .weather-condition {
            font-size: 24px;
            font-weight: 500;
            margin-bottom: 40px;
        }

        .weather-icon {
            font-size: 80px;
            margin: 30px 0;
        }

        .condition-text {
            font-size: 24px;
            font-weight: 500;
            margin-top: 20px;
        }

        .compare-button {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 40px;
            background: white;
            border: 2px solid #000;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .compare-button:hover {
            background: #000;
            color: white;
        }

        /* Future Comparison Screen */
        .future-screen {
            padding: 30px;
        }

        .future-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .future-temp {
            font-size: 100px;
            font-weight: 900;
            color: #ff6b35;
            line-height: 1;
            margin: 30px 0 20px;
        }

        .future-subtitle {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .future-impact {
            font-size: 16px;
            color: #333;
            margin-bottom: 30px;
        }

        .chart-section {
            margin-top: 40px;
        }

        .chart-tabs {
            display: flex;
            border-bottom: 1px solid #e5e5e5;
            margin-bottom: 20px;
        }

        .chart-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            font-size: 14px;
            color: #999;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }

        .chart-tab.active {
            color: #000;
            border-bottom-color: #ff6b35;
        }

        .chart-container {
            height: 200px;
            margin-bottom: 20px;
        }

        .timeline-info {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-top: 20px;
        }

        .timeline-label {
            font-size: 12px;
            color: #999;
            margin-bottom: 5px;
        }

        .timeline-value {
            font-size: 14px;
            font-weight: 600;
        }

        .timeline-change {
            font-size: 12px;
            color: #ff6b35;
        }

        /* Action Screen */
        .action-screen {
            padding: 30px;
        }

        .action-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 30px;
        }

        .action-card {
            background: white;
            border: 1px solid #e5e5e5;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .action-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .action-content h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .action-content p {
            font-size: 14px;
            color: #666;
        }

        .action-icon {
            font-size: 24px;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 500px;
            height: 60px;
            background: white;
            border-top: 1px solid #e5e5e5;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .nav-item {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            font-size: 12px;
            color: #999;
            transition: color 0.3s;
        }

        .nav-item.active {
            color: #000;
        }

        .nav-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }

        @media (max-width: 480px) {
            .splash-logo {
                font-size: 100px;
            }

            .temp-display {
                font-size: 100px;
            }

            .future-temp {
                font-size: 80px;
            }
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div class="splash-screen" id="splashScreen">
        <div class="splash-logo">+4°</div>
        <div class="splash-tagline">Track how your city is warming</div>
        <button class="splash-button" onclick="enterApp()">Enter App</button>
    </div>

    <!-- Main App -->
    <div class="app-container" id="appContainer">
        <div class="header">
            <span class="back-button" onclick="goBack()">←</span>
            <span class="location-name" id="locationName">Loading...</span>
        </div>

        <!-- Current Weather Screen -->
        <div class="screen active" id="currentScreen">
            <div class="current-weather-screen">
                <div class="temp-display" id="currentTemp">--°F</div>
                <div class="weather-icon" id="weatherIcon">☀️</div>
                <div class="condition-text" id="weatherCondition">Sunny</div>
                <button class="compare-button" onclick="showFuture()">Compare to future</button>
            </div>
        </div>

        <!-- Future Comparison Screen -->
        <div class="screen" id="futureScreen">
            <div class="future-screen">
                <div class="future-title"><span id="futureCity">Miami</span> in a<br>+4° world</div>
                <div class="future-temp" id="futureTemp">93°F</div>
                <div class="future-subtitle">based on IPCC RCP8.5.5 scenario (year 2100)</div>
                <div class="future-impact" id="futureImpact">25 more days over 85° pz year</div>

                <div class="chart-section">
                    <div class="chart-tabs">
                        <div class="chart-tab active" onclick="switchTab('temperature')">Temperature</div>
                        <div class="chart-tab" onclick="switchTab('rainfall')">Rainfall</div>
                        <div class="chart-tab" onclick="switchTab('sealevel')">Sea Level</div>
                    </div>
                    <div class="chart-container">
                        <canvas id="climateChart"></canvas>
                    </div>
                    <div class="timeline-info">
                        <div>
                            <div class="timeline-label">Today</div>
                            <div class="timeline-value" id="todayValue">--°F</div>
                        </div>
                        <div style="text-align: right;">
                            <div class="timeline-label">2010+</div>
                            <div class="timeline-value">Avg : <span id="avgTemp">--</span>°F*D</div>
                            <div class="timeline-change">+ <span id="tempIncrease">--</span>°F</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Screen -->
        <div class="screen" id="actionScreen">
            <div class="action-screen">
                <h2 class="action-title">Take action</h2>

                <div class="action-card" onclick="showInfo('miami')">
                    <div class="action-content">
                        <h3>What +4°C means for <span id="actionCity">Miami</span></h3>
                    </div>
                    <div class="action-icon">→</div>
                </div>

                <div class="action-card" onclick="showInfo('do')">
                    <div class="action-content">
                        <h3>What can you do?</h3>
                    </div>
                    <div class="action-icon">⚡</div>
                </div>

                <div class="action-card" onclick="showInfo('support')">
                    <div class="action-content">
                        <h3>Support climate science</h3>
                    </div>
                    <div class="action-icon">♥</div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-item active" onclick="showScreen('current')">
                <div class="nav-icon">☀️</div>
                <div>Today</div>
            </div>
            <div class="nav-item" onclick="showScreen('future')">
                <div class="nav-icon">📈</div>
                <div>Future</div>
            </div>
            <div class="nav-item" onclick="showScreen('action')">
                <div class="nav-icon">💚</div>
                <div>Action</div>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = 'c8391c039501f3053b0f22faf7434153';
        let currentCity = 'Miami';
        let currentTempC = 0;
        let currentTempF = 0;

        function enterApp() {
            document.getElementById('splashScreen').classList.add('hidden');
            document.getElementById('appContainer').classList.add('visible');
            loadWeatherData();
        }

        function goBack() {
            const screens = ['current', 'future', 'action'];
            const currentIndex = screens.findIndex(s => 
                document.getElementById(s + 'Screen').classList.contains('active')
            );
            if (currentIndex > 0) {
                showScreen(screens[currentIndex - 1]);
            }
        }

        function showScreen(screen) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screen + 'Screen').classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            event.currentTarget?.classList.add('active');
        }

        function showFuture() {
            showScreen('future');
            drawChart();
        }

        function switchTab(tab) {
            document.querySelectorAll('.chart-tab').forEach(t => t.classList.remove('active'));
            event.currentTarget.classList.add('active');
        }

        function showInfo(type) {
            const messages = {
                miami: `In a +4°C world, ${currentCity} will experience:\n\n• 25+ more extreme heat days per year\n• 20% increase in heavy rainfall events\n• Increased risk of coastal flooding\n• More intense hurricanes`,
                do: `Actions you can take today:\n\n🚴 Use public transit, bike, or walk\n⚡ Switch to renewable energy\n🌱 Reduce meat consumption\n♻️ Reduce, reuse, recycle\n🗳️ Vote for climate action`,
                support: `Support organizations working on climate science:\n\n• Donate to climate research\n• Share +4° with friends\n• Join local climate groups\n• Advocate for policy change`
            };
            alert(messages[type]);
        }

        function celsiusToFahrenheit(c) {
            return Math.round((c * 9/5) + 32);
        }

        async function getWeatherByCoords(lat, lon) {
            try {
                const response = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${API_KEY}`
                );
                const data = await response.json();
                updateWeatherDisplay(data);
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function getWeatherByCity(city) {
            try {
                const response = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?q=${city}&units=metric&appid=${API_KEY}`
                );
                const data = await response.json();
                updateWeatherDisplay(data);
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function updateWeatherDisplay(data) {
            currentTempC = Math.round(data.main.temp);
            currentTempF = celsiusToFahrenheit(currentTempC);
            currentCity = data.name;

            const futureTempC = currentTempC + 4;
            const futureTempF = celsiusToFahrenheit(futureTempC);
            const increase = futureTempF - currentTempF;

            document.getElementById('locationName').textContent = currentCity;
            document.getElementById('currentTemp').textContent = `${currentTempF}°F`;
            document.getElementById('weatherCondition').textContent = 
                data.weather[0].main;

            document.getElementById('futureCity').textContent = currentCity;
            document.getElementById('actionCity').textContent = currentCity;
            document.getElementById('futureTemp').textContent = `${futureTempF}°F`;
            document.getElementById('todayValue').textContent = `${currentTempF}°F`;
            document.getElementById('avgTemp').textContent = futureTempF;
            document.getElementById('tempIncrease').textContent = increase;

            const extraHotDays = Math.round(increase * 2.5);
            document.getElementById('futureImpact').textContent = 
                `${extraHotDays} more days over 85° per year`;

            const condition = data.weather[0].main.toLowerCase();
            const icons = {
                clear: '☀️',
                clouds: '☁️',
                rain: '🌧️',
                snow: '🌨️',
                thunderstorm: '⛈️'
            };
            document.getElementById('weatherIcon').textContent = 
                icons[condition] || '☀️';
        }

        function drawChart() {
            const canvas = document.getElementById('climateChart');
            const ctx = canvas.getContext('2d');
            const dpr = window.devicePixelRatio || 1;
            
            canvas.width = canvas.offsetWidth * dpr;
            canvas.height = canvas.offsetHeight * dpr;
            ctx.scale(dpr, dpr);
            
            const width = canvas.offsetWidth;
            const height = canvas.offsetHeight;
            const padding = 30;

            ctx.clearRect(0, 0, width, height);

            const years = [2024, 2040, 2060, 2080, 2100];
            const temps = [currentTempF, currentTempF + 1, currentTempF + 2, currentTempF + 3, currentTempF + 4];

            ctx.strokeStyle = '#ff6b35';
            ctx.lineWidth = 3;
            ctx.lineJoin = 'round';
            ctx.beginPath();

            years.forEach((year, i) => {
                const x = padding + (width - padding * 2) * (i / (years.length - 1));
                const y = height - padding - ((temps[i] - currentTempF) / 4) * (height - padding * 2);
                
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });

            ctx.stroke();

            years.forEach((year, i) => {
                const x = padding + (width - padding * 2) * (i / (years.length - 1));
                const y = height - padding - ((temps[i] - currentTempF) / 4) * (height - padding * 2);

                ctx.beginPath();
                ctx.fillStyle = '#ff6b35';
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function loadWeatherData() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        getWeatherByCoords(position.coords.latitude, position.coords.longitude);
                    },
                    () => {
                        getWeatherByCity('Miami');
                    }
                );
            } else {
                getWeatherByCity('Miami');
            }
        }

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('data:text/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZnVuY3Rpb24oZSkgewogIGUud2FpdFVudGlsKAogICAgY2FjaGVzLm9wZW4oJ2NsaW1hdGUtd2VhdGhlci12MScpLnRoZW4oZnVuY3Rpb24oY2FjaGUpIHsKICAgICAgcmV0dXJuIGNhY2hlLmFkZEFsbChbCiAgICAgICAgJy8nCiAgICAgIF0pOwogICAgfSkKICApOwp9KTs=')
                    .catch(err => console.log('SW registration failed'));
            });
        }
    </script>
</body>
</html>